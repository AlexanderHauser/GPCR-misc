#! /usr/bin/python

from ete2 import Tree, faces, AttrFace, TreeStyle, NodeStyle

def layout(node):
    if node.is_leaf():
        N = AttrFace("name", fsize=30)
        faces.add_face_to_node(N, node, 0, position="aligned")

def get_example_tree():


    t = Tree("(((((((((((((CHRM1:0.10096,(CHRM3:0.09341,CHRM5:0.09159):0.01154):0.04535,(CHRM2:0.07210,CHRM4:0.06790):0.07965):0.16120,HRH1:0.30681):0.02918,(((((((((ADRA1C:0.12362,ADRA1B:0.12138):0.02169,ADRA1A:0.14831):0.12352,((ADRB1:0.15343,ADRB2R:0.16157):0.02694,ADRB3:0.18306):0.09710):0.00578,((DRD1:0.10278,DRD5:0.10222):0.17188,((HTR1A:0.22537,((HTR1B:0.11903,HTRL:0.12097):0.06933,(HTR1E:0.15716,HTR1EL:0.15784):0.03692):0.04275):0.04095,(HTR4:0.26135,HTR7:0.26365):0.00612):0.00360):0.01565):0.00376,HRH2:0.28793):0.00221,((ADRAR:0.11349,(ADRA2RL1:0.10095,ADRA2L2:0.10405):0.00901):0.16402,((DRD2:0.12147,DRD3:0.12353):0.12070,DRD4:0.24180):0.02504):0.02314):0.00962,((HTR1C:0.12123,HTR2A:0.12377):0.04480,HTR2B:0.16270):0.14600):0.00471,HTR6:0.31784):0.00378,HTR5A:0.32680):0.01267):0.00614,((TA1:0.25228,(TAAR2:0.23146,GPR57:0.24593):0.03518):0.05170,(TAAR5:0.26617,((TRAR4:0.09240,TAR5:0.09447):0.06314,TRAR3:0.15259):0.11568):0.02307):0.05244):0.00827,(GPCR97:0.22469,HRH4:0.24031):0.12556):0.00517,((ADORA1:0.20855,ADORA3:0.20854):0.02758,(ADORA2:0.15475,ADORA2B:0.15179):0.07292):0.12009):0.00527,GPR119:0.37416):0.00393,(((GPR12:0.20268,(GPR3:0.18146,GPR6:0.18854):0.00982):0.15330,((MC1R:0.24228,(MC4R:0.19670,MC5R:0.20637):0.05536):0.03529,MC2R:0.28691):0.06799):0.01161,((CNR:0.24804,CNR2:0.25196):0.10745,(((((CHEDG1:0.16502,S1PR3:0.17498):0.05208,EDG5:0.22042):0.01687,S1PR5:0.23188):0.02159,EDG6:0.26778):0.04589,((EDG2:0.20910,EDG7:0.20590):0.00163,LPA2:0.20087):0.10387):0.04544):0.00840):0.02085):0.01099,(((((NTSR1:0.23231,NTSR2:0.24269):0.07237,GPR39:0.32513):0.02026,((NMUR1:0.18808,NMUR2:0.18692):0.10724,(GHSR:0.19557,MTLR1:0.19136):0.10978):0.01673):0.02435,TRHR:0.35893):0.02440,(GPR139:0.27987,GPR142:0.30513):0.13588):0.01054):0.00362,(((((((GPR26:0.22250,GPR78:0.22750):0.15951,PGR8:0.41396):0.00591,(BALGR:0.31550,GPR62:0.32086):0.08169):0.00459,(((GPR173:0.17245,GPR85:0.16755):0.05392,GPR27:0.21108):0.17437,(GPBAR1:0.39655,(GPR40:0.34154,(FFAR2:0.25941,(FFAR3:0.00487,GPR42P:0.00519):0.24812):0.06299):0.05031):0.00951):0.00698):0.00187,(((((((TUBB3:0.45767,CPSF7:0.46111):0.00556,(SSF1:0.45561,LRRC70:0.44745):0.01375):0.00605,(((((((CALCRL:0.19383,CALCR:0.19277):0.13991,(CRF2R:0.15476,CRFR1:0.14626):0.18555):0.00729,((((GIPR:0.17928,GCGR:0.17786):0.02898,GLP1R:0.20571):0.01848,GLP2R:0.22386):0.03863,(GHRHR:0.25432,((PTHR1:0.14251,PTHR2:0.14467):0.10229,(((ADCYAP1R1:0.18117,VIPR1:0.17598):0.00466,SCTR:0.17391):0.01395,VIP2R:0.18758):0.05162):0.01280):0.01587):0.06997):0.06564,((((((EMR1:0.26002,((EMR2:0.07089,EMR3:0.07197):0.09877,EMR4:0.17419):0.08067):0.03178,((ETL:0.21630,((KIAA0821:0.10544,LPHN2:0.11395):0.03372,LEC3:0.14485):0.06942):0.06075,CD97:0.26387):0.01664):0.05666,(((CELSR3:0.23343,(CELSR1:0.20350,MEGF3:0.20466):0.03698):0.10033,GPR133:0.32824):0.00499,GPR144:0.34380):0.00823):0.02063,(((((GPR112:0.16425,HE6:0.15718):0.03255,VIGR:0.19449):0.10992,GPR97:0.32056):0.01605,(TM7LN4:0.28784,GPR114:0.29379):0.03212):0.02949,GPR128:0.36026):0.00947):0.00587,(BAI2:0.16146,(BAI3:0.14406,BAI1:0.13799):0.02489):0.20070):0.00992,((GPR110:0.25136,((PGR20:0.17578,GPR115:0.17626):0.04291,KIAA0758:0.21475):0.02542):0.09999,PGR23:0.33624):0.04146):0.01440):0.01386,(KIAA1531:0.24061,(GPR125:0.22629,KIAA1828:0.22966):0.00292):0.18402):0.02132,(GPR51:0.28875,GABBR1:0.27407):0.16410):0.01197,(((((GRM1:0.10686,GPRC1E:0.11075):0.11852,(MGLUR2:0.10973,GRM3:0.12343):0.11541):0.01211,(MGLUR6:0.12410,(GPRC1D:0.07985,(GRM7:0.05301,MGLUR8:0.05413):0.02984):0.04684):0.11311):0.09831,(PCAR1:0.26411,GPRC6A:0.27198):0.07097):0.04162,(TR3:0.35814,(GPR71:0.33617,T1R1:0.33399):0.03441):0.01095):0.07378):0.01452):0.00696,(FY:0.43823,((GPR48:0.27076,(LGR5:0.22641,LGR6:0.23859):0.04174):0.13853,((SLIT1:0.23349,SLIL3:0.23651):0.14888,MEGF5:0.38612):0.05991):0.01019):0.00625):0.00512,(PGR1:0.28402,GPR162:0.28598):0.15797):0.00734,(GPR152:0.39823,(((MAS1:0.32989,GPR168:0.32338):0.01965,MRG:0.35295):0.00292,((MRGD:0.29197,(((SNSR3:0.07227,SNSR1:0.08350):0.02182,MRGX4:0.09627):0.06420,MRGPRX2:0.16570):0.12134):0.01564,(MRGPRE:0.31951,GPR169:0.31366):0.00688):0.02165):0.05843):0.01493):0.00209,((((PTGER1:0.31073,PTGFR:0.31871):0.01514,TBXA2R:0.30631):0.02666,PTGER3:0.33789):0.03531,(((PTGDR:0.27790,PTGER2:0.27486):0.05675,PTGIR:0.30549):0.03963,PTGER4:0.35847):0.01640):0.04665):0.00260):0.00196,(PGR7:0.39648,STRG:0.39749):0.01311):0.00514,((GPR82:0.39682,BTR:0.43481):0.01759,GPR160:0.43684):0.00499):0.00310):0.00378,(((((GPR135:0.33829,GPR101:0.36879):0.01040,(GPR161:0.36668,(GPR45:0.20868,PSP24B:0.21343):0.14124):0.01119):0.01239,((((CCKAR:0.17199,CCKRB:0.17145):0.16288,(PROKR1:0.03419,GPR73L1:0.03581):0.33774):0.00837,(((((GR3:0.28844,((NPY1R:0.23150,Y2B:0.24826):0.02585,NPY4R:0.26364):0.04479):0.01417,(NPY2R:0.29441,NPYR5:0.32368):0.01335):0.01952,(KIAA1540:0.32437,((NK1R:0.13880,TAC3R:0.13620):0.03982,TAC2R:0.17018):0.14887):0.01869):0.00687,(((GPR147:0.15531,GPR74:0.16469):0.13793,(HCRTR1:0.12142,HCRTR2:0.11979):0.17548):0.03027,QRFPR:0.34111):0.00999):0.01050,GPR19:0.37429):0.00506):0.00476,(((((AVPR1:0.21159,VPR3:0.20594):0.00951,OXTR:0.21828):0.04809,DIR:0.26778):0.07011,NPSR1:0.34583):0.01400,GNRHR:0.37286):0.02121):0.00843):0.00319,(GPR21:0.14099,GPR52:0.15068):0.26438):0.00223,((GPR75:0.39854,(GPR176:0.39350,GPR22:0.38933):0.01258):0.01041,((((OPN2:0.27617,(OPN1MW2:0.03666,OPN1LW:0.03872):0.24895):0.01315,OPN1SW:0.30595):0.05001,OPN3:0.32461):0.02500,(RGR:0.37633,(TMEM13:0.34246,(MOP:0.30533,RRH:0.34467):0.00504):0.01457):0.00625):0.02735):0.00490):0.00147):0.00144,(((((((((AGTR1:0.29933,AGTR2:0.30168):0.00180,RDC1:0.31327):0.02098,CEPR:0.33796):0.00807,GPR182:0.36260):0.01355,((((GPR15:0.29263,GPR25:0.29237):0.02661,APLNR:0.31220):0.01806,(((((CXCR1:0.05675,IL8RB:0.05325):0.21733,MDR15:0.28767):0.00105,(CCR10:0.26356,GPR9:0.24664):0.02491):0.01854,(((((STRL22:0.24520,CMKBR7:0.23980):0.02237,CCR9:0.26513):0.00929,VSHK1:0.28071):0.01254,BONZO:0.29665):0.01607,CXCR4:0.29587):0.01218):0.02277,(((((((CCR1:0.13894,CMKBR3:0.14389):0.04796,(CCR2:0.09202,CMKBR5:0.09298):0.10385):0.03276,CCR4:0.22053):0.02965,CMKBRL1:0.23665):0.00525,CMKBR8:0.26293):0.02774,CRAM:0.31036):0.02467,XCR1:0.31215):0.02709):0.00685):0.00839,(BRADYB1:0.28300,BDKRB2:0.28266):0.06697):0.00147):0.00819,((((C5AR1:0.28035,C5L2:0.30046):0.03328,((AZ3B:0.28512,((FPR1:0.13068,FPR2:0.12432):0.03465,FPRL2:0.17035):0.13738):0.00694,(CMKLR1:0.27907,GPR1:0.29093):0.02056):0.00845):0.01474,((EMBOSS_001:0.09878,GPR32:0.08194):0.25316,GPR33:0.35036):0.00742):0.00828,(PTGDR2:0.31849,(BLT:0.23875,BLTR2:0.25625):0.06901):0.01844):0.01824):0.00234,(((((((OPRD:0.14225,(OPRK1:0.13843,OPRM1:0.14157):0.00525):0.04879,OPRL1:0.18871):0.08558,((SSTR1:0.14669,SSTR4:0.13831):0.06860,(SSTR2:0.19079,(SSTR3:0.14821,SSTR5:0.14179):0.03421):0.02640):0.05598):0.01217,(NPBWR1:0.15113,NPBWR2:0.14387):0.14424):0.02938,(SALPR:0.23763,RLN3R2:0.24237):0.08304):0.01765,((GALR1:0.27786,(GALNR2:0.16712,GALNR3:0.16454):0.10777):0.01303,GPR54:0.30952):0.04029):0.00754,(SLC1:0.28760,MCHR2:0.29740):0.06497):0.00795):0.00304,(GPR14:0.34756,((TG1019:0.29171,(GPR81:0.17989,(GPR109A:0.02311,HCA3:0.02189):0.15011):0.11285):0.02921,GPR31:0.30609):0.04579):0.01083):0.00439,(((((((F2R:0.29023,PAR2:0.28477):0.01438,P2RY8:0.30062):0.01176,(PAR3:0.29251,F2RL3:0.28749):0.01137):0.03347,((((LPA4:0.20068,LPAR6:0.21346):0.10731,GPR92:0.30690):0.01572,(GPR35:0.31941,GPR55:0.32883):0.01745):0.01365,GPR20:0.33210):0.00390):0.00245,((GPR132:0.31592,((GPR4:0.20815,OGR1:0.21185):0.06819,GPR65:0.28431):0.03158):0.03753,(((P2RY10:0.21724,GPR174:0.20990):0.11091,PAFR:0.32611):0.02550,((EBI2:0.32920,(CYSLT1:0.30323,CYSLT2R:0.30083):0.01633):0.00974,GPR17:0.32274):0.00406):0.00616):0.00382):0.00736,(((P2RY15:0.29678,GPR91:0.29322):0.01144,(P2RY1:0.27881,((P2RY2:0.16962,P2RY4:0.17538):0.08264,P2RY6:0.26245):0.01881):0.02740):0.02856,P2RY11:0.34709):0.01453):0.00953,(((GPR171:0.33480,((GPR95:0.21394,P2RY14:0.22106):0.02926,(P2RY12:0.21940,GPR94:0.22560):0.02824):0.06270):0.04110,GPR34:0.34285):0.03347,GPCRW:0.38491):0.00352):0.01703):0.01335,(((((NMBR:0.15314,GRPR:0.15686):0.01956,BRS3:0.17794):0.15455,((ETRA:0.15609,EDNRB:0.14340):0.17351,(ETBRLP2:0.16545,GPR37:0.15955):0.19681):0.01658):0.04094,(GPR84:0.37693,((MTNR1A:0.15089,MTNR1B:0.14911):0.08069,GPR50:0.24153):0.13686):0.00237):0.00285,(((FSHR:0.14722,(LHCGR:0.13532,TSHR:0.12968):0.01528):0.20011,(LGR7:0.16951,LGR8:0.17049):0.18864):0.03876,PGR4:0.36251):0.01342):0.00386);")
    #for n in t.traverse():
    #    n.dist = 1
    
    # Set dashed blue lines in all leaves
    nst1 = NodeStyle()
    nst1["bgcolor"] = "LightSteelBlue"
    nst2 = NodeStyle()
    nst2["bgcolor"] = "Moccasin"
    nst3 = NodeStyle()
    nst3["bgcolor"] = "DarkSeaGreen"
    nst4 = NodeStyle()
    nst4["bgcolor"] = "Khaki"

    n1 = t.get_common_ancestor("CXCR4","NTSR1","NTSR2")
    n1.set_style(nst1)
    n2 = t.get_common_ancestor("ADRB1","ADRB2R","DRD3","CHRM2","HRH1","CHRM3")
    n2.set_style(nst2)
    n3 = t.get_common_ancestor("ADORA1","ADORA2")
    n3.set_style(nst3)

    ts = TreeStyle()
    ts.layout_fn = layout
    ts.show_leaf_name = False

    ts.mode = "c"
    ts.root_opening_factor = 1
    return t, ts
    
if __name__ == "__main__":
    t, ts = get_example_tree()
    #t.render("node_background.png", w=400, tree_style=ts)
    t.show(tree_style=ts)